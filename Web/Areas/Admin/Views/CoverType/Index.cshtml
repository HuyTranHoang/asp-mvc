@model IEnumerable<CoverType>

@{
    ViewData["Title"] = "CoverType";
    ViewData["ControllerName"] = "CoverType";

    var index = 1;

    var pager = ViewBag.Pager != null ? ViewBag.Pager : new Pager();

    var searchString = Context.Request.Query["s"];

    var successMessage = TempData["SuccessMessage"];

}

<section class="bg-body-tertiary mt-4 pb-3 rounded-bottom shadow-lg">
    <h1 class="bg-body-secondary bg-gradient px-3 py-4 rounded-top text-center">Cover Type List</h1>

    <div class="d-flex justify-content-between px-4 py-2">
        <div class="align-items-center d-flex position-relative">
            <input class="form-control" id="search" name="search" placeholder="Search..." style="padding-right: 35px" type="text">
            <button class="btn end-0 position-absolute top-0" id="clearButton" style="display: none">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <a asp-action="Upsert" class="btn btn-primary text-decoration-none text-white">
            <i class="fa-plus fa-regular"></i> Create new category
        </a>
    </div>

    <div class="p-4">
        <table class="table table-bordered table-striped" id="tblCoverType">
            <thead>
            <tr class="table-primary">
                <th scope="col" style="width: 5%">#</th>
                <th scope="col">
                    Name
                </th>

                <th scope="col" style="width: 20%">
                    Created At
                </th>
                <th scope="col" style="width: 20%">Actions</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var coverType in Model)
            {
                <tr>
                    <td>@index</td>
                    <td>@coverType.Name</td>
                    <td>@coverType.CreatedAt</td>
                    <td>
                        <div class="d-flex">
                            <a asp-action="Upsert" asp-route-id="@coverType.Id" class="btn btn-secondary fw-semibold me-3 px-4 text-white">
                                <i class="fa-pen-to-square fa-regular"></i> Edit
                            </a>

                            <button class="btn btn-danger delete-button fw-semibold px-4" data-id="@coverType.Id">
                                <i class="fa-regular fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>

                index++;
            }

            @if (!Model.Any())
            {
                <tr>
                    <td class="text-center" colspan="5">No cover type found!</td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</section>

@section Scripts {
    <partial model="successMessage" name="_NotificationScriptsPartial" />
    <partial model="pager" name="_DeleteScript" />

    <script >
      $(function() {
          const dataTable = $('#tblCoverType').DataTable({
            columnDefs: [
                {orderable: false, targets: 3}
            ],
          })

          handleSearchBox(dataTable)
          function handleSearchBox(dataTable) {
              //Enable search box outside
              const searchInput = $("#search")
              const clearSearchButton = $("#clearButton")
              searchInput.keyup(function () {
                  dataTable.search($(this).val()).draw()
                  if (searchInput.val().length > 0) {
                      clearSearchButton.css("display", "block");
                  } else {
                      clearSearchButton.css("display", "none");
                  }
              })
              //Clear search button
              clearSearchButton.click(function () {
                  searchInput.val("")
                  clearSearchButton.css("display", "none");
                  dataTable.search($(this).val()).draw()
              })
          }
      })
    </script>
}